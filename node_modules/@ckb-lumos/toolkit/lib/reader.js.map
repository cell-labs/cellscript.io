{"version":3,"file":"reader.js","names":["BaseReader","constructor","__isByteLikeReader__","isReader","x","ArrayBufferReader","buffer","view","DataView","length","byteLength","indexAt","i","getUint8","toArrayBuffer","serializeJson","Array","prototype","map","call","Uint8Array","toString","slice","join","HexStringReader","string","parseInt","substr","ArrayBuffer","setUint8","Reader","input","startsWith","Error","from","fromRawString","c","charCodeAt"],"sources":["../src/reader.js"],"sourcesContent":["class BaseReader {\n  constructor() {\n    /**\n     * instanceof would be nice here, but when a user use multi version of Reader that may cause problem\n     * @example\n     * const { Reader } = require('ckb-js-toolkit'); // ckb-js-toolkit@0.100.1\n     * const { readSomething } = require('other-serializer-lib'); // dependent on ckb-js-toolkit@0.100.0\n     *\n     * readSomething() instanceof Reader; // false\n     *\n     * @type {boolean}\n     * @protected\n     */\n    this.__isByteLikeReader__ = true;\n  }\n\n  static isReader(x) {\n    if (x == null) return false;\n    if (x instanceof BaseReader) return true;\n    return x.__isByteLikeReader__ === true;\n  }\n}\n\nclass ArrayBufferReader extends BaseReader {\n  constructor(buffer) {\n    super();\n    this.view = new DataView(buffer);\n  }\n\n  length() {\n    return this.view.byteLength;\n  }\n\n  indexAt(i) {\n    return this.view.getUint8(i);\n  }\n\n  toArrayBuffer() {\n    return this.view.buffer;\n  }\n\n  serializeJson() {\n    return (\n      \"0x\" +\n      Array.prototype.map\n        .call(new Uint8Array(this.view.buffer), (x) =>\n          (\"00\" + x.toString(16)).slice(-2)\n        )\n        .join(\"\")\n    );\n  }\n}\n\nclass HexStringReader extends BaseReader {\n  constructor(string) {\n    super();\n    this.string = string;\n  }\n\n  length() {\n    return this.string.length / 2 - 1;\n  }\n\n  indexAt(i) {\n    return parseInt(this.string.substr(2 + i * 2, 2), 16);\n  }\n\n  toArrayBuffer() {\n    const buffer = new ArrayBuffer(this.length());\n    const view = new DataView(buffer);\n\n    for (let i = 0; i < this.length(); i++) {\n      view.setUint8(i, this.indexAt(i));\n    }\n    return buffer;\n  }\n\n  serializeJson() {\n    return this.string;\n  }\n}\n/**\n * @deprecated please follow the {@link https://lumos-website.vercel.app/migrations/migrate-to-v0.19 migration-guide}\n */\nexport class Reader extends BaseReader {\n  constructor(input) {\n    super();\n    if (\n      input instanceof HexStringReader ||\n      input instanceof ArrayBufferReader\n    ) {\n      return input;\n    }\n    if (typeof input === \"string\") {\n      if (!input.startsWith(\"0x\") || input.length % 2 !== 0) {\n        throw new Error(\n          \"Hex string must start with 0x, and has even numbered length!\"\n        );\n      }\n      return new HexStringReader(input);\n    }\n    if (input instanceof ArrayBuffer) {\n      return new ArrayBufferReader(input);\n    }\n    if (input instanceof Uint8Array) {\n      return new ArrayBufferReader(Uint8Array.from(input).buffer);\n    }\n    throw new Error(\"Reader can only accept hex string or ArrayBuffer!\");\n  }\n\n  static from(x) {\n    return new Reader(x);\n  }\n\n  static fromRawString(string) {\n    const buffer = new ArrayBuffer(string.length);\n    const view = new DataView(buffer);\n\n    for (let i = 0; i < string.length; i++) {\n      const c = string.charCodeAt(i);\n      if (c > 0xff) {\n        throw new Error(\"fromRawString can only accept UTF-8 raw string!\");\n      }\n      view.setUint8(i, c);\n    }\n    return new ArrayBufferReader(buffer);\n  }\n}\n"],"mappings":"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"}