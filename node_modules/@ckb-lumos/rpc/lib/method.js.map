{"version":3,"file":"method.js","names":["Method","name","config","options","method","paramsFormatters","resultFormatters","undefined","node","constructor","timeout","Object","defineProperty","call","value","configurable","writable","params","payload","getPayload","axios","headers","data","url","httpAgent","httpsAgent","then","res","id","IdNotMatchException","error","ResponseException","JSON","stringify","result","map","p","i","Math","round","random","jsonrpc"],"sources":["../src/method.ts"],"sourcesContent":["import axios from \"axios\";\nimport { IdNotMatchException, ResponseException } from \"./exceptions\";\nimport { CKBComponents } from \"./types/api\";\nimport { RPCConfig } from \"./types/common\";\n\nexport class Method {\n  #name: string;\n  #config: RPCConfig;\n\n  get name(): string {\n    return this.#name;\n  }\n\n  #options: CKBComponents.Method = {\n    name: \"\",\n    method: \"\",\n    paramsFormatters: [],\n    resultFormatters: undefined,\n  };\n\n  #node: CKBComponents.Node;\n\n  constructor(\n    node: CKBComponents.Node,\n    options: CKBComponents.Method,\n    config: RPCConfig = { timeout: 30000 }\n  ) {\n    this.#node = node;\n    this.#options = options;\n    this.#name = options.name;\n    this.#config = config;\n\n    Object.defineProperty(this.call, \"name\", {\n      value: options.name,\n      configurable: false,\n      writable: false,\n    });\n  }\n\n  /* eslint-disable @typescript-eslint/ban-types, @typescript-eslint/explicit-module-boundary-types */\n  public call = (...params: (string | number | object)[]) => {\n    const payload = this.getPayload(...params);\n    return axios({\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\",\n      },\n      data: payload,\n      url: this.#node.url,\n      httpAgent: this.#node.httpAgent,\n      httpsAgent: this.#node.httpsAgent,\n      timeout: this.#config.timeout,\n    }).then((res) => {\n      if (res.data.id !== payload.id) {\n        throw new IdNotMatchException(payload.id, res.data.id);\n      }\n      if (res.data.error) {\n        throw new ResponseException(JSON.stringify(res.data.error));\n      }\n      return (\n        this.#options.resultFormatters?.(res.data.result) ?? res.data.result\n      );\n    });\n  };\n\n  public getPayload = (...params: (string | number | object)[]) => {\n    const data = params.map(\n      (p, i) =>\n        (this.#options.paramsFormatters[i] &&\n          this.#options.paramsFormatters[i](p)) ||\n        p\n    );\n    const id = Math.round(Math.random() * 10000);\n    const payload = {\n      id,\n      method: this.#options.method,\n      params: data,\n      jsonrpc: \"2.0\",\n    };\n    return payload;\n  };\n}\n/* eslint-enable @typescript-eslint/ban-types, @typescript-eslint/explicit-module-boundary-types */\n"],"mappings":"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"}