{"version":3,"file":"paramsFormatter.js","names":["formatter","toOptional","format","arg","undefined","toArray","Array","isArray","map","toHash","hash","StringHashTypeException","startsWith","toNumber","number","toString","BigintOrHexStringTypeException","HexStringWithout0xException","toScript","script","codeHash","hashType","hash_type","rest","code_hash","toOutPoint","outPoint","txHash","index","tx_hash","toInput","input","previousOutput","since","previous_output","toOutput","output","capacity","lock","type","toDepType","toOrder","order","toCellDep","cellDep","depType","out_point","dep_type","toRawTransaction","transaction","version","cellDeps","inputs","outputs","outputsData","outputs_data","headerDeps","header_deps","formattedInputs","formattedOutputs","formattedCellDeps","tx","cell_deps","toPageNumber","pageNo","toPageSize","pageSize","size","BI","from","MAX_SIZE","MIN_SIZE","gt","PageSizeTooLargeException","lt","PageSizeTooSmallException","toReverseOrder","reverse","toOutputsValidator","outputsValidator","VALIDATORS","indexOf","OutputsValidatorTypeException","toBoolean","value","toTransactionProof","proof","blockHash","block_hash","witnessesRoot","witnesses_root","toSearchFilter","data","output_data_len_range","outputDataLenRange","output_capacity_range","outputCapacityRange","block_range","blockRange","script_len_range","scriptLenRange","toSearchKey","script_type","scriptType","filter","toGetCellsSearchKey","with_data","withData","toGetTransactionsSearchKey","group_by_transaction","groupByTransaction"],"sources":["../src/paramsFormatter.ts"],"sourcesContent":["import {\n  PageSizeTooLargeException,\n  PageSizeTooSmallException,\n  OutputsValidatorTypeException,\n  BigintOrHexStringTypeException,\n  StringHashTypeException,\n  HexStringWithout0xException,\n} from \"./exceptions\";\nimport { BI } from \"@ckb-lumos/bi\";\nimport { RPC } from \"./types/rpc\";\nimport { CKBComponents } from \"./types/api\";\n\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nexport const formatter = {\n  toOptional: (format?: (args: any) => any) => (arg: any) => {\n    if (!format || arg === undefined || arg === null) {\n      return arg;\n    }\n    return format(arg);\n  },\n  toArray: (format?: (args: any) => any) => (arg: any) => {\n    if (typeof format !== \"function\" || !Array.isArray(arg)) {\n      return arg;\n    }\n    return arg.map(format);\n  },\n  toHash: (hash: string): RPC.Hash256 => {\n    if (typeof hash !== \"string\") {\n      throw new StringHashTypeException(hash);\n    }\n    return hash.startsWith(\"0x\") ? hash : `0x${hash}`;\n  },\n  toNumber: (number: CKBComponents.Number | bigint): RPC.Number => {\n    if (typeof number === \"bigint\") {\n      return `0x${number.toString(16)}`;\n    }\n    if (typeof number !== \"string\") {\n      throw new BigintOrHexStringTypeException(number);\n    }\n    if (!number.startsWith(\"0x\")) {\n      throw new HexStringWithout0xException(number);\n    }\n    return number;\n  },\n  toScript: (script: CKBComponents.Script): RPC.Script => {\n    const { codeHash, hashType: hash_type, ...rest } = script;\n    return {\n      code_hash: formatter.toHash(codeHash),\n      hash_type,\n      ...rest,\n    };\n  },\n  toOutPoint: (outPoint: CKBComponents.OutPoint): RPC.OutPoint => {\n    const { txHash, index, ...rest } = outPoint;\n    return {\n      tx_hash: formatter.toHash(txHash),\n      index: formatter.toNumber(index),\n      ...rest,\n    };\n  },\n  toInput: (input: CKBComponents.CellInput): RPC.CellInput => {\n    if (!input) return input;\n    const { previousOutput, since, ...rest } = input;\n    return {\n      previous_output: formatter.toOutPoint(previousOutput),\n      since: formatter.toNumber(since),\n      ...rest,\n    };\n  },\n  toOutput: (output: CKBComponents.CellOutput): RPC.CellOutput => {\n    if (!output) return output;\n    const { capacity, lock, type = undefined, ...rest } = output;\n    return {\n      capacity: formatter.toNumber(capacity),\n      lock: formatter.toScript(lock),\n      type: type ? formatter.toScript(type) : type,\n      ...rest,\n    };\n  },\n  toDepType: (type: CKBComponents.DepType) => {\n    if (type === \"depGroup\") {\n      return \"dep_group\";\n    }\n    return type;\n  },\n  toOrder: (order: CKBComponents.Order) => {\n    return order;\n  },\n  toCellDep: (cellDep: CKBComponents.CellDep): RPC.CellDep => {\n    if (!cellDep) return cellDep;\n    const { outPoint, depType = \"code\", ...rest } = cellDep;\n    return {\n      out_point: formatter.toOutPoint(outPoint),\n      dep_type: formatter.toDepType(depType),\n      ...rest,\n    };\n  },\n  toRawTransaction: (\n    transaction: CKBComponents.RawTransaction\n  ): RPC.RawTransaction => {\n    if (!transaction) return transaction;\n    const {\n      version,\n      cellDeps = [],\n      inputs = [],\n      outputs = [],\n      outputsData: outputs_data = [],\n      headerDeps: header_deps = [],\n      ...rest\n    } = transaction;\n    const formattedInputs = inputs.map((input) => formatter.toInput(input));\n    const formattedOutputs = outputs.map((output) =>\n      formatter.toOutput(output)\n    );\n    const formattedCellDeps = cellDeps.map((cellDep) =>\n      formatter.toCellDep(cellDep)\n    );\n    const tx = {\n      version: formatter.toNumber(version),\n      cell_deps: formattedCellDeps,\n      inputs: formattedInputs,\n      outputs: formattedOutputs,\n      outputs_data,\n      header_deps,\n      ...rest,\n    };\n    return tx;\n  },\n  toPageNumber: (pageNo: string | bigint = \"0x1\") => formatter.toNumber(pageNo),\n  toPageSize: (pageSize: string | bigint = \"0x32\") => {\n    const size = BI.from(pageSize);\n    const MAX_SIZE = 50;\n    const MIN_SIZE = 0;\n    if (BI.from(size).gt(MAX_SIZE))\n      throw new PageSizeTooLargeException(pageSize, MAX_SIZE);\n    if (BI.from(size).lt(MIN_SIZE))\n      throw new PageSizeTooSmallException(pageSize, MIN_SIZE);\n    return formatter.toNumber(`0x${size.toString(16)}`);\n  },\n  toReverseOrder: (reverse = false) => !!reverse,\n  toOutputsValidator: (outputsValidator: CKBComponents.OutputsValidator) => {\n    if (!outputsValidator) return undefined;\n    const VALIDATORS = [\"default\", \"passthrough\"];\n    if (VALIDATORS.indexOf(outputsValidator) > -1) {\n      return outputsValidator;\n    }\n    throw new OutputsValidatorTypeException();\n  },\n  toBoolean: (value: boolean) => {\n    return !!value;\n  },\n  toTransactionProof: (\n    proof: CKBComponents.TransactionProof\n  ): RPC.TransactionProof => {\n    if (!proof) return proof;\n    const {\n      blockHash: block_hash,\n      witnessesRoot: witnesses_root,\n      ...rest\n    } = proof;\n    return {\n      block_hash,\n      witnesses_root,\n      ...rest,\n    };\n  },\n  toSearchFilter: (data: CKBComponents.SearchFilter): RPC.SearchFilter => {\n    if (!data) return data;\n    return {\n      script: data.script ? formatter.toScript(data.script) : data.script,\n      output_data_len_range: data.outputDataLenRange,\n      output_capacity_range: data.outputCapacityRange,\n      block_range: data.blockRange,\n      script_len_range: data.scriptLenRange,\n    };\n  },\n  toSearchKey: (data: CKBComponents.SearchKey): RPC.SearchKey => {\n    if (!data) return data;\n    return {\n      script: formatter.toScript(data.script),\n      script_type: data.scriptType,\n      filter: data.filter ? formatter.toSearchFilter(data.filter) : data.filter,\n    };\n  },\n  toGetCellsSearchKey: (\n    data: CKBComponents.GetCellsSearchKey\n  ): RPC.GetCellsSearchKey => {\n    if (!data) return data;\n    return {\n      ...formatter.toSearchKey(data),\n      with_data: data.withData,\n    };\n  },\n  toGetTransactionsSearchKey: (\n    data: CKBComponents.GetTransactionsSearchKey\n  ): RPC.GetTransactionsSearchKey => {\n    if (!data) return data;\n    return {\n      ...formatter.toSearchKey(data),\n      group_by_transaction: data.groupByTransaction,\n    };\n  },\n};\n/* eslint-enable camelcase, @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\n"],"mappings":"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"}