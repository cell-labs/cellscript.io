{"version":3,"file":"error.js","names":["CODEC_OPTIONAL_PATH","CodecBaseParseError","Error","constructor","message","expectedType","CODEC_EXECUTE_ERROR_NAME","isCodecExecuteError","error","name","CodecExecuteError","origin","keys","updateKey","key","push","getPackErrorMessage","reducer","acc","cur","index","path","reduceRight","stack","replace"],"sources":["../src/error.ts"],"sourcesContent":["// lc for lumos codec\nexport const CODEC_OPTIONAL_PATH = \"__lc_option__\";\ntype CodecOptionalPath = typeof CODEC_OPTIONAL_PATH;\nexport class CodecBaseParseError extends Error {\n  constructor(message: string, public expectedType: string) {\n    super(message);\n  }\n}\n\nconst CODEC_EXECUTE_ERROR_NAME = \"CodecExecuteError\";\nexport function isCodecExecuteError(\n  error: unknown\n): error is CodecExecuteError {\n  if (!(error instanceof Error)) return false;\n  return error.name === CODEC_EXECUTE_ERROR_NAME;\n}\n\n/**\n * This Error class can collect CodecBaseParseError, and put an human-readable error\n */\nexport class CodecExecuteError extends Error {\n  name = CODEC_EXECUTE_ERROR_NAME;\n  constructor(private origin: CodecBaseParseError) {\n    super();\n  }\n\n  keys: (number | string | CodecOptionalPath)[] = [];\n\n  public updateKey(key: number | string | symbol): void {\n    this.keys.push(key as number | string);\n    this.message = this.getPackErrorMessage();\n  }\n\n  private getPackErrorMessage(): string {\n    type CodecPath = number | string | CodecOptionalPath;\n\n    const reducer = (acc: string, cur: CodecPath, index: number) => {\n      if (cur === CODEC_OPTIONAL_PATH) {\n        cur = index === 0 ? \"?\" : \"?.\";\n      } else if (typeof cur === \"number\") {\n        cur = `[${cur}]`;\n      } else {\n        cur = `.${cur}`;\n      }\n      return acc + cur;\n    };\n\n    const path = this.keys.reduceRight(reducer, \"input\");\n\n    return `Expect type ${this.origin.expectedType} at ${path} but got error: ${\n      this.origin.message\n    }\n    ${this.origin.stack?.replace(/Error:.+?\\n/, \"\")}\n    `;\n  }\n}\n"],"mappings":";;;;;;;AAAA;AACO,MAAMA,mBAAmB,GAAG,eAA5B;;;AAEA,MAAMC,mBAAN,SAAkCC,KAAlC,CAAwC;EAC7CC,WAAW,CAACC,OAAD,EAAyBC,YAAzB,EAA+C;IACxD,MAAMD,OAAN;IADwD,KAAtBC,YAAsB,GAAtBA,YAAsB;EAEzD;;AAH4C;;;AAM/C,MAAMC,wBAAwB,GAAG,mBAAjC;;AACO,SAASC,mBAAT,CACLC,KADK,EAEuB;EAC5B,IAAI,EAAEA,KAAK,YAAYN,KAAnB,CAAJ,EAA+B,OAAO,KAAP;EAC/B,OAAOM,KAAK,CAACC,IAAN,KAAeH,wBAAtB;AACD;AAED;AACA;AACA;;;AACO,MAAMI,iBAAN,SAAgCR,KAAhC,CAAsC;EAC3CO,IAAI,GAAGH,wBAAH;;EACJH,WAAW,CAASQ,MAAT,EAAsC;IAC/C;IAD+C,KAA7BA,MAA6B,GAA7BA,MAA6B;EAEhD;;EAEDC,IAAI,GAA4C,EAA5C;;EAEGC,SAAS,CAACC,GAAD,EAAsC;IACpD,KAAKF,IAAL,CAAUG,IAAV,CAAeD,GAAf;IACA,KAAKV,OAAL,GAAe,KAAKY,mBAAL,EAAf;EACD;;EAEOA,mBAAmB,GAAW;IAAA;;IAGpC,MAAMC,OAAO,GAAG,CAACC,GAAD,EAAcC,GAAd,EAA8BC,KAA9B,KAAgD;MAC9D,IAAID,GAAG,KAAKnB,mBAAZ,EAAiC;QAC/BmB,GAAG,GAAGC,KAAK,KAAK,CAAV,GAAc,GAAd,GAAoB,IAA1B;MACD,CAFD,MAEO,IAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B;QAClCA,GAAG,GAAI,IAAGA,GAAI,GAAd;MACD,CAFM,MAEA;QACLA,GAAG,GAAI,IAAGA,GAAI,EAAd;MACD;;MACD,OAAOD,GAAG,GAAGC,GAAb;IACD,CATD;;IAWA,MAAME,IAAI,GAAG,KAAKT,IAAL,CAAUU,WAAV,CAAsBL,OAAtB,EAA+B,OAA/B,CAAb;IAEA,OAAQ,eAAc,KAAKN,MAAL,CAAYN,YAAa,OAAMgB,IAAK,mBACxD,KAAKV,MAAL,CAAYP,OACb;AACL,MAHW,sBAGL,KAAKO,MAAL,CAAYY,KAHP,uDAGL,mBAAmBC,OAAnB,CAA2B,aAA3B,EAA0C,EAA1C,CAA8C;AACpD,KAJI;EAKD;;AAlC0C"}