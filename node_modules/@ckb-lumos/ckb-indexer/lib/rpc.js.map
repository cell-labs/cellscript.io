{"version":3,"file":"rpc.js","names":["RPC","constructor","uri","getTip","utils","deepCamel","request","getCells","searchKey","order","limit","cursor","params","toGetCellsSearchKey","getTransactions","toGetTransactionsSearchKey","getIndexerInfo","ckbIndexerUrl","method","res","fetch","body","JSON","stringify","id","jsonrpc","headers","status","Error","data","json","error","undefined","result"],"sources":["../src/rpc.ts"],"sourcesContent":["import { HexString, Tip, utils } from \"@ckb-lumos/base\";\nimport {\n  GetLiveCellsResult,\n  IndexerTransactionList,\n  Order,\n  GetCellsSearchKey,\n  GetTransactionsSearchKey,\n} from \"./type\";\nimport fetch from \"cross-fetch\";\nimport {\n  toGetCellsSearchKey,\n  toGetTransactionsSearchKey,\n} from \"./paramsFormatter\";\n\nexport class RPC {\n  private uri: string;\n\n  /**\n   *\n   * @param uri  indexer uri\n   */\n  constructor(uri: string) {\n    this.uri = uri;\n  }\n\n  async getTip(): Promise<Tip> {\n    return utils.deepCamel(await request(this.uri, \"get_tip\"));\n  }\n  async getCells<WithData extends boolean = true>(\n    searchKey: GetCellsSearchKey<WithData>,\n    order: Order,\n    limit: HexString,\n    cursor?: string\n  ): Promise<GetLiveCellsResult<WithData>> {\n    const params = [toGetCellsSearchKey(searchKey), order, limit, cursor];\n    return utils.deepCamel(await request(this.uri, \"get_cells\", params));\n  }\n\n  async getTransactions<Grouped extends boolean = false>(\n    searchKey: GetTransactionsSearchKey<Grouped>,\n    order: Order,\n    limit: HexString,\n    cursor?: string\n  ): Promise<IndexerTransactionList<Grouped>> {\n    const params = [\n      toGetTransactionsSearchKey(searchKey),\n      order,\n      limit,\n      cursor,\n    ];\n    return utils.deepCamel(await request(this.uri, \"get_transactions\", params));\n  }\n  async getIndexerInfo(): Promise<string> {\n    return utils.deepCamel(await request(this.uri, \"get_indexer_info\"));\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nconst request = async (\n  ckbIndexerUrl: string,\n  method: string,\n  params?: any\n): Promise<any> => {\n  const res = await fetch(ckbIndexerUrl, {\n    method: \"POST\",\n    body: JSON.stringify({\n      id: 0,\n      jsonrpc: \"2.0\",\n      method,\n      params,\n    }),\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  });\n  if (res.status !== 200) {\n    throw new Error(`indexer request failed with HTTP code ${res.status}`);\n  }\n  const data = await res.json();\n  if (data.error !== undefined) {\n    throw new Error(\n      `indexer request rpc failed with error: ${JSON.stringify(data.error)}`\n    );\n  }\n  return data.result;\n};\n/* eslint-enalbe @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\n"],"mappings":";;;;;;;AAAA;;AAQA;;AACA;;;;AAKO,MAAMA,GAAN,CAAU;EAGf;AACF;AACA;AACA;EACEC,WAAW,CAACC,GAAD,EAAc;IACvB,KAAKA,GAAL,GAAWA,GAAX;EACD;;EAEW,MAANC,MAAM,GAAiB;IAC3B,OAAOC,WAAA,CAAMC,SAAN,CAAgB,MAAMC,OAAO,CAAC,KAAKJ,GAAN,EAAW,SAAX,CAA7B,CAAP;EACD;;EACa,MAARK,QAAQ,CACZC,SADY,EAEZC,KAFY,EAGZC,KAHY,EAIZC,MAJY,EAK2B;IACvC,MAAMC,MAAM,GAAG,CAAC,IAAAC,oCAAA,EAAoBL,SAApB,CAAD,EAAiCC,KAAjC,EAAwCC,KAAxC,EAA+CC,MAA/C,CAAf;IACA,OAAOP,WAAA,CAAMC,SAAN,CAAgB,MAAMC,OAAO,CAAC,KAAKJ,GAAN,EAAW,WAAX,EAAwBU,MAAxB,CAA7B,CAAP;EACD;;EAEoB,MAAfE,eAAe,CACnBN,SADmB,EAEnBC,KAFmB,EAGnBC,KAHmB,EAInBC,MAJmB,EAKuB;IAC1C,MAAMC,MAAM,GAAG,CACb,IAAAG,2CAAA,EAA2BP,SAA3B,CADa,EAEbC,KAFa,EAGbC,KAHa,EAIbC,MAJa,CAAf;IAMA,OAAOP,WAAA,CAAMC,SAAN,CAAgB,MAAMC,OAAO,CAAC,KAAKJ,GAAN,EAAW,kBAAX,EAA+BU,MAA/B,CAA7B,CAAP;EACD;;EACmB,MAAdI,cAAc,GAAoB;IACtC,OAAOZ,WAAA,CAAMC,SAAN,CAAgB,MAAMC,OAAO,CAAC,KAAKJ,GAAN,EAAW,kBAAX,CAA7B,CAAP;EACD;;AAxCc;AA2CjB;;;;;AACA,MAAMI,OAAO,GAAG,OACdW,aADc,EAEdC,MAFc,EAGdN,MAHc,KAIG;EACjB,MAAMO,GAAG,GAAG,MAAM,IAAAC,mBAAA,EAAMH,aAAN,EAAqB;IACrCC,MAAM,EAAE,MAD6B;IAErCG,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;MACnBC,EAAE,EAAE,CADe;MAEnBC,OAAO,EAAE,KAFU;MAGnBP,MAHmB;MAInBN;IAJmB,CAAf,CAF+B;IAQrCc,OAAO,EAAE;MACP,gBAAgB;IADT;EAR4B,CAArB,CAAlB;;EAYA,IAAIP,GAAG,CAACQ,MAAJ,KAAe,GAAnB,EAAwB;IACtB,MAAM,IAAIC,KAAJ,CAAW,yCAAwCT,GAAG,CAACQ,MAAO,EAA9D,CAAN;EACD;;EACD,MAAME,IAAI,GAAG,MAAMV,GAAG,CAACW,IAAJ,EAAnB;;EACA,IAAID,IAAI,CAACE,KAAL,KAAeC,SAAnB,EAA8B;IAC5B,MAAM,IAAIJ,KAAJ,CACH,0CAAyCN,IAAI,CAACC,SAAL,CAAeM,IAAI,CAACE,KAApB,CAA2B,EADjE,CAAN;EAGD;;EACD,OAAOF,IAAI,CAACI,MAAZ;AACD,CA3BD;AA4BA"}